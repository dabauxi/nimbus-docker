version: "3.0"

services:
  nimbus:
    image: statusim/nimbus-eth2:amd64-${NIMBUS_VERSION}
    container_name: nimbus
    restart: always
    stop_grace_period: 1m
    ports:
      - "9000:9000/tcp"
      - "9000:9000/udp"
      # Metrics port
      - "127.0.0.1:8008:8008/tcp"
      # REST API port
      - "127.0.0.1:5052:5052/tcp"
    volumes:
      - ./nimbus-config:/home/user/nimbus-eth2/config:ro
      - ./validator_keys:/var/lib/nimbus/validator_keys:ro
      - ${CONSENSUS_DATA}:/var/lib/nimbus
      - ./secrets/:/secrets:ro
    command: >-
      --network=${NETWORK}
      --config-file=/home/user/nimbus-eth2/config/config.toml
      ${NIMBUS_MEVBOOST_FLAGS}
    env_file: .env
  geth:
    image: ethereum/client-go:${GETH_VERSION}
    container_name: geth
    stop_grace_period: 5m
    volumes:
        - ${EXECUTION_DATA}:/root/.ethereum
        - ./secrets/jwtsecret:/var/lib/goethereum/ee-secret/jwtsecret:ro
    ports:
        - 30303:30303/tcp
        - 30303:30303/udp
    command: >-
      --http
      --http.addr=0.0.0.0
      --http.vhosts=*
      --http.corsdomain=*
      --http.api=web3,eth,net
      --datadir=/var/lib/goethereum
      --port=30303
      --http.port=8545
      --${NETWORK}
      --metrics
      --metrics.expensive
      --pprof
      --pprof.addr=0.0.0.0
      --authrpc.jwtsecret=/var/lib/goethereum/ee-secret/jwtsecret
      --authrpc.addr=0.0.0.0
      --authrpc.port=8551
      --authrpc.vhosts=*
    env_file: .env
    restart: always
  mevboost:
    image: flashbots/mev-boost:${MEVBOOST_VERSION}
    container_name: mevboost
    restart: always
    command: >-
      -${NETWORK}
      -addr 0.0.0.0:18550
      -relay-check
      -relays ${MEV_RELAYS}
    env_file: .env
